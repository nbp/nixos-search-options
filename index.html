<html>
<head>
<!--  
<script type="text/javascript" src="bootstrap.min.js"></script> 
  <link rel="stylesheet" href="bootstrap.min.css" />
-->

<link rel="stylesheet" href="bootstrap-responsive.min.css" />
<link rel="stylesheet" href="nixos-site.css" type="text/css" />
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="jquery-ui.min.js"></script>

<style type="text/css">
#info {
   display: inline-block;
   padding: 2px 4px;
   font-size: 11.844px;
   font-weight: bold;
   line-height: 14px;
   color: #fff;
   background-color: #468847;
   text-shadow: 0 -1px 0 rgba(0,0,0,0.25);
   white-space: nowrap;
   vertical-align: baseline;
};
</style>


</head>
 <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
<h1> Search NixOS options</h1>

<div id="obbb">
<div id="bbb">
<input name="query" type="text" class="search-query span3" placeholder="Search by name or description" id="search" value="" autofocus="autofocus" style="background: #fff url('share-sprite-new.png') no-repeat -269px -92px !important; padding-left: 22px !important;width: 288px; height: 22px; margin: 0px"> <div id="info">?</div> (options in selection)
</div>
<br>
<input type="checkbox" id="nameCB" checked="true" onchange="update()">path,
<input type="checkbox" id="descriptionCB" checked="true" onchange="update()">description,
<input type="checkbox" id="defaultCB" checked="true" onchange="update()">default,
<input type="checkbox" id="commentCB" checked="true" onchange="update()">comment,
<input type="checkbox" id="exampleCB" checked="true" onchange="update()">example,
<input type="checkbox" id="declarationsCB" checked="true" onchange="update()">declarations
</div>

<br>
<br>

<div id="result"></a>

<script type="text/javascript">

var optionsList;

var optionsJSON = "./options.json";

function toggle_visibility(id) {
       var e = document.getElementById(id);
       if(e.style.display == '')
          e.style.display = 'none';
       else
          e.style.display = '';
}

function populate() {
    var dom = "";
    optionsList.map(function(value) {



dom += "<div id=\"" + value.name + "\">" +  " <dt><span class=\"term\"><a class=\"term\" shape=\"rect\"><code class=\"option\"><a href=\"#\" onclick=\"toggle_visibility('" + value.name + "foo" + "')\">" + value.name + "</a></code></span></dt> \
<div id=\"" + value.name + "foo" + "\"><dd><p>" + value.description + 
"</p><p><span class=\"emphasis\"><em>Default:</em></span> <code class=\"literal\">" + value.default + 
"</code></p><p><span class=\"emphasis\"><em>Example:</em></span> <code class=\"literal\">" + value.example + "</code></p></dd> " +
"<p><span class=\"emphasis\"><em>Declared by:</em></span></p>" +
"<table class=\"simplelist\" border=\"0\" summary=\"Simple list\"><tbody><tr><td rowspan=\"1\" colspan=\"1\"><code class=\"filename\"><a class=\"filename\" href=\"https://github.com/NixOS/nixpkgs/blob/2b270536954cd4c2dbda62d7589c84f3a2f33009/nixos/modules/config/shells-environment.nix\" target=\"_top\" shape=\"rect\"> &lt;nixpkgs/nixos/modules/config/shells-environment.nix&gt; </a></code></td></tr></tbody></table></div></div>";

    });
    document.getElementById("result").innerHTML = dom;

}

function init() {
  function onError(e) {
    console.log( "error downloading or parsing json" );
  }

  function onLoad(e) {
    console.log("received json");
    optionsList = JSON.parse(req.responseText);
    console.log("parsed json");

    populate();

    update();
  }

  var req = new XMLHttpRequest();
  req.open("GET", optionsJSON, true);
  req.onload = onLoad;
  req.onerror = onError;
  req.send(null);
}

function update() {
    var filteredList= [];

    var words = $('#search').val().toLowerCase().split(/ +/).filter(Boolean);
    //console.log(words);
    //console.log(optionsList);

    var nameCB = (document.getElementById("nameCB").checked==true);
    var descriptionCB = (document.getElementById("descriptionCB").checked==true);
    var defaultCB = (document.getElementById("defaultCB").checked==true);
    var commentCB = (document.getElementById("commentCB").checked==true);
    var exampleCB = (document.getElementById("exampleCB").checked==true);
    var declarationsCB = (document.getElementById("declarationsCB").checked==true);

    if (words.length) {
      filterList = optionsList.filter(function (value){
        var name = value.name + "";
        var description = (value.description || "") + "";
        var default_ = (value["default"] || "") + "";
        var comment = (value.comment || "") + "";
        var example = (value.example || "") + "";
        var declarations = (value.declarations || "") + "";

        if (words.length > 0) {
          function match(word) {
            return((nameCB && (name.toLowerCase().indexOf(word) != -1))
                || (descriptionCB && (description.toLowerCase().indexOf(word) != -1))
                || (defaultCB && (default_.toLowerCase().indexOf(word) != -1))
                || (commentCB && (comment.toLowerCase().indexOf(word) != -1))
                || (exampleCB && (example.toLowerCase().indexOf(word) != -1))
                || (declarationsCB && (declarations.toLowerCase().indexOf(word) != -1)));
            };
          return words.every(match);
        }
      });
    } else {
      filterList = optionsList;
    }

    //console.log(filteredList);

    // finally display those left

    optionsList.forEach(function(value) {
      document.getElementById(value.name).style.display = "none";
    });
    filterList.forEach(function(value) {
      document.getElementById(value.name).style.display = "";
    });
    document.getElementById("info").innerHTML = filterList.length;  
}

$('#search').on('input', function() {
  update();
});
$( document ).ready( init() )
</script>

</body>
</html>
